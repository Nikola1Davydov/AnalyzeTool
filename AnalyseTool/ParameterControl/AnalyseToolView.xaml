<Window
    x:Class="AnalyseTool.ParameterControl.Views.AnalyseToolView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:scm="clr-namespace:System.ComponentModel;assembly=WindowsBase"
    xmlns:viewmodel="clr-namespace:AnalyseTool.ParameterControl.ViewModels"
    Title="Analyze Tool"
    Width="850"
    Height="600"
    MinWidth="500"
    MinHeight="300"
    Icon="pack://application:,,,/AnalyseTool;component/Resources/Icons/AnalyzeTool_Icon.ico"
    mc:Ignorable="d">


    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="60" />
            <RowDefinition />
        </Grid.RowDefinitions>
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <Button
                x:Name="btn_Cancel"
                Grid.Column="1"
                Margin="10,10,0,10"
                Command="{Binding ExportToExcelCommand}"
                Content="Export to CSV" />

            <TextBox
                Grid.Row="0"
                Margin="10"
                VerticalContentAlignment="Center"
                Text="{Binding ParameterFilter, UpdateSourceTrigger=PropertyChanged}" />
        </Grid>

        <DataGrid
            x:Name="dataGridData"
            Grid.Row="1"
            d:ItemsSource="{d:SampleData}"
            AutoGenerateColumns="False"
            CanUserAddRows="False"
            CanUserDeleteRows="False"
            GridLinesVisibility="None"
            ItemsSource="{Binding ParameterCollectionView}"
            RowDetailsVisibilityMode="VisibleWhenSelected"
            SelectionMode="Single">

            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <EventSetter Event="PreviewMouseLeftButtonDown" Handler="DataGridRow_MouseLeftButtonDown" />
                </Style>
            </DataGrid.RowStyle>

            <DataGrid.Columns>

                <!--  Column for displaying the category  -->
                <DataGridTemplateColumn Header="Category Name">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock VerticalAlignment="Center" Text="{Binding CategoriesString}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!--  Column for displaying the parameter name  -->
                <DataGridTemplateColumn Header="Parameter Name">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock VerticalAlignment="Center" Text="{Binding Name}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!--  Column for displaying the parameter count  -->
                <DataGridTemplateColumn Header="Parameter&#10;Count">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock VerticalAlignment="Center" Text="{Binding ParameterCount}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!--  Column for displaying the count of empty parameters  -->
                <DataGridTemplateColumn Header="Parameter&#10;Empty">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock VerticalAlignment="Center" Text="{Binding ParameterEmpty}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!--  Column for displaying the count of filled parameters  -->
                <DataGridTemplateColumn Header="Parameter&#10;Filled">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock VerticalAlignment="Center" Text="{Binding ParameterFilled}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!--  Column for displaying the percentage of filled parameters  -->
                <DataGridTemplateColumn Header="Parameter&#10;Filled in %">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid VerticalAlignment="Center">
                                <!--  Rectangle visualizing the percentage  -->
                                <Rectangle
                                    Width="{Binding ParameterFilledProzent}"
                                    Height="18"
                                    HorizontalAlignment="Left"
                                    Fill="Pink" />
                                <!--  Text displaying the percentage  -->
                                <TextBlock HorizontalAlignment="Center" Text="{Binding ParameterFilledProzent}" />
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!--  Column with a button to select empty elements  -->
                <DataGridTemplateColumn Header="Select Empty&#10;Elements">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button
                                VerticalContentAlignment="Center"
                                Command="{Binding DataContext.SelectElementsCommand, RelativeSource={RelativeSource AncestorType={x:Type Window}}}"
                                CommandParameter="{Binding}"
                                Content="Select" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!--  Column with a button to select filled elements  -->
                <DataGridTemplateColumn Header="Select Filled&#10;Elements">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button
                                VerticalContentAlignment="Center"
                                Command="{Binding DataContext.SelectFilledElementsCommand, RelativeSource={RelativeSource AncestorType={x:Type Window}}}"
                                CommandParameter="{Binding}"
                                Content="Select" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

            </DataGrid.Columns>

            <!--  RowDetailsTemplate to display child elements  -->
            <DataGrid.RowDetailsTemplate>
                <DataTemplate>
                    <Grid MaxHeight="200">

                        <ListView
                            x:Name="dataGridData"
                            Grid.Row="1"
                            d:ItemsSource="{d:SampleData ItemCount=2}"
                            ItemsSource="{Binding ChildParameters}">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn>
                                        <GridViewColumnHeader Content="Parameter&#10;Name" />
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Name}" />
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn>
                                        <GridViewColumnHeader Content="Parameter&#10;Filled" />
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding ParameterFilled}" />
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn>
                                        <GridViewColumnHeader Content="Parameter&#10;Filled in %" />
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <Grid>
                                                    <Rectangle
                                                        Width="{Binding ParameterFilledProzent}"
                                                        HorizontalAlignment="Left"
                                                        Fill="Pink" />
                                                    <TextBlock HorizontalAlignment="Center" Text="{Binding ParameterFilledProzent}" />
                                                </Grid>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn>
                                        <GridViewColumnHeader Content="Select Filled&#10;Elements" />
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <Button
                                                    VerticalContentAlignment="Center"
                                                    Command="{Binding DataContext.SelectFilledElementsCommand, RelativeSource={RelativeSource AncestorType={x:Type Window}}}"
                                                    CommandParameter="{Binding}"
                                                    Content="Select" />
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </Grid>
                </DataTemplate>

            </DataGrid.RowDetailsTemplate>

        </DataGrid>
    </Grid>
</Window>
